# Dockerfile. Основные инструкции.
Dockerfile - текстовый файл, позволяющий создавать свои образы на основе уже существующих.

Dockerfile состоит из инструкций и их аргументов, которые определяют как собирать образ и запускать контейнер.

## Инструкции: FROM, WORKDIR, COPY
1. `FROM` - задаёт базовый образ, вокруг которого всё будет строиться: ```FROM ubuntu:20.04```
2. `WORKDIR` - задаёт рабочую директорию внутри контейнера. Все производимые далее действия с контейнером будут выполняться внутри этой директории: ```WORKDIR /app```
3. `COPY` - копирует файл из хоста в рабочуцю директорию контейнера: ```COPY <host> <container>```

## Инструкция RUN
Запускает команды на этапе сборки образа. Как правило это команды установки внешних утилит, библиотек и зависимостей.

Есть ещё такая штука: __apt-get__ - это инструмент командной строки для взаимодействия с системой управления пакетами для дистрибутивов Linux. Её можно использовать для установки в контейнер Linux каких-то утилит:

```
RUN apt-get update && apt-get install -y <package>
```

Использование RUN для установки зависимостей приложения:

```
RUN pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt
```

## Инструкции CMD и ENTRYPOINT
Обе инструкции задают команду, которая будет выполнена при запуске контейнера, то есть задают точку входа в контейнер. Есть тонкости в различиях этих двух команд и в их совместном использовании(читайть документацию).

Пример использования - запуск своего приложения:
```
CMD ["python", "app/main.py"]
```

## ! Важный момент !
Образ - это многослойный пирог. (почти) Каждая инструкция в Dockerfile создаёт слой, который кэшируется докером и из этих последовательных слоев создается образ. Если dockerfile будет изменён в некотором месте, то при очередной сборке образа, все слои, предшествующие изменению будут взяты из кэша, что ускоряет сборку.

В связи с этим совет: рекомендуется сначала описывать инструкции по установке всех необходимых утилит и зависимостей, а потом копировать всякие локальные файлы. Это будет значительно экономить время и память, затраченную на сборку, так как изменения в основном происходят в локальных файлах, а слои с установкой зависимостей будут кэшироваться.
